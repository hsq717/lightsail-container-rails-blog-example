<div class="container">
  <article class="post">
    <header class="post-header">
      <h1><%= @post.title %></h1>
      <div class="post-meta">
        <span>By <%= @post.author %></span>
        <span><%= @post.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
      </div>
      <div class="post-actions">
        <%= link_to 'Edit', edit_post_path(@post), class: 'btn btn-secondary' %>
        <%= button_to 'Delete', @post, method: :delete, data: { turbo_confirm: 'Are you sure?' }, class: 'btn btn-danger' %>
        <%= link_to 'Back to Posts', posts_path, class: 'btn btn-outline' %>
      </div>
    </header>

    <div class="post-content">
      <%= simple_format(@post.content) %>
    </div>

    <% if @post.valid_images.any? %>
      <div class="post-images">
        <h3>Images</h3>
        <div class="image-gallery">
          <% @post.valid_images.each do |image| %>
            <div class="image-item">
              <%= image_tag image, class: 'post-image' %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </article>

  <section class="comments-section">
    <h3>Comments (<%= @post.comments.count %>)</h3>
    
    <div class="comment-form">
      <h4>Add a Comment</h4>
      <%= form_with model: [@post, @comment], local: true do |form| %>
        <div class="form-group">
          <%= form.label :author %>
          <%= form.text_field :author, class: 'form-control', required: true %>
        </div>
        
        <div class="form-group">
          <%= form.label :content %>
          <%= form.text_area :content, rows: 4, class: 'form-control', required: true %>
        </div>
        
        <div class="form-actions">
          <%= form.submit 'Post Comment', class: 'btn btn-primary' %>
        </div>
      <% end %>
    </div>

    <div class="comments">
      <% if @post.comments.any? %>
        <% @post.comments.order(created_at: :desc).each do |comment| %>
          <div class="comment">
            <div class="comment-header">
              <strong><%= comment.author %></strong>
              <span class="comment-date"><%= comment.created_at.strftime("%B %d, %Y at %I:%M %p") %></span>
              <%= button_to 'Delete', [@post, comment], method: :delete, data: { turbo_confirm: 'Are you sure?' }, class: 'btn btn-sm btn-danger' %>
            </div>
            <div class="comment-content">
              <%= simple_format(comment.content) %>
            </div>
          </div>
        <% end %>
      <% else %>
        <p class="no-comments">No comments yet. Be the first to comment!</p>
      <% end %>
    </div>
  </section>
</div>
